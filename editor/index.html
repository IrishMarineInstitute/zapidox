
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- prism for js highlights -->
  <link rel="icon" href="../../favicon.ico">
  <link rel="stylesheet" href="../css/siimple.css">
  <!-- see https://siimple.juanes.xyz/ -->
  <link rel="stylesheet" href="../css/demo.css">
  <script src="../js/jquery-3.4.1.min.js"></script>
  <title>zapidox: editor</title>
</head>

<body>
  <div class="siimple-content">
  <div class="siimple-box" align="center">
    <div class="siimple-box-title">zapidox: editor</div>
  </div>

  <div class="siimple-grid">
  <div class="siimple-grid-row">
    <div class="siimple-grid-col siimple-grid-col--2">&nbsp;</div>
    <div class="siimple-grid-col siimple-grid-col--9">

	  <label class="siimple-label">Paste your ERDDAP query: </label>
	    <input id="erddap_query_url" name="erddap_url" value="https://erddap.marine.ie/erddap/tabledap/IMI-TidePrediction_epa.htmlTable?time%2Clongitude%2Clatitude%2CstationID%2Csea_surface_height&time%3E=now&time%3C=now+3d&stationID=%22BPNBF050000140001_MODELLED%22" class="siimple-input siimple-input--fluid" placeholder="paste your ERDDAP query here" />
    <label class="siimple-label">New Method Name: </label>
      <input id="query_name" class="siimple-input siimple-input--fluid" placeholder="myGetSomeDataMethodName" value="myGetSomeDataMethodName"/>
    <label class="siimple-label">Description: </label>
      <textarea id="query_description" class="siimple-textarea siimple-textarea--fluid" rows="5" >Gets some useful and valuable data from the ERDDAP data server</textarea>
    <div class="siimple-label">Formats:</div>
    <br>
    <label class="siimple-label">csv0</label>
    <div class="siimple-checkbox">
        <input type="checkbox" id="csv0" value=".csv0" checked>
        <label for="csv0"></label>
    </div>
    <label class="siimple-label">jsonlKVP</label>
    <div class="siimple-checkbox">
        <input type="checkbox" id="jsonlKVP" value=".jsonlKVP" checked>
        <label for="jsonlKVP"></label>
    </div>

  <br />
	<div id="doit" class="siimple-btn siimple-btn--primary">Show Zapidox</div>
	<br />
	<label class="siimple-label">Zapidox:</label>
    <textarea id="output" class="siimple-textarea siimple-textarea--fluid" rows="5" ></textarea>
    </div>
  </div>
  <hr>
  <div class="siimple-footer" align="center">
    Another Project by Marine Institute
  </div>
  </div>
  <!-- erddap -->
  <script src="../js/erddap.js"></script>
  <script src="../js/zapidox.js"></script>
  <script>
    $("#doit").click(function(){
      var erddap_query_url = $("#erddap_query_url").val();
      try{
        erddap_query_url = new URL(erddap_query_url);
      }catch(err){
         $("#output").val("could not parse the erddap query url");
         return;
      }
      getErddapZapidocs(erddap_query_url.toString()).then(function(zapidox){
        if(typeof(zapidox) == "string"){
          $("#output").val("There is an error in the current zapidox; please fix that first...");
          //TODO: be more helpful.
          return;
        }
        var formats = [];
        $(':checkbox:checked').each(function(i){
          formats[i] = $(this).val();
        });
        if(formats.length == 0){
          formats.push(".csv0");
        }
        zapidox.push({name: $("#query_name").val(), 
            description: $("#query_description").val(), 
            formats: formats, 
            query: erddap_query_url.search.substring(1)});
        var lines = JSON.stringify(zapidox,null,4).split("\n");
        lines.unshift('        <att name="zapidox"><![CDATA[');
        lines.push("]]></att>")
        $("#output").val(lines.join("\n"));
        $("#output").attr("rows",lines.length);
      },function(err){
        $("#output").val(err);
      });
    });
  </script>
</body>

</html>
